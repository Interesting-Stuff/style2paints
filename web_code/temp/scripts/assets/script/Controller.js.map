{"version":3,"sources":["assets\\script\\Controller.js"],"names":["spSketchImg","spRefereneImg","spResultImg","spColorImg","spHintNode","spBTN","spLAB","fileInputForSketch","fileInputForReferene","mousePosition","mouseInReference","loaded","getMouseDown","preMouseInRef","selectingColor","painting","finalX","finalY","hasSketch","hasRef","HTML_Canvas_sketch","HTML_Canvas_reference","HTML_Canvas_hint","isPen","mouseIsDown","resultURL","version","createObjectURL","blob","window","URL","undefined","onSketchFileSelected","evt","loadLocalSketch","target","files","onRefereneFileSelected","loadLocalReference","uri","tempDiv","document","getElementById","createElement","body","appendChild","style","position","id","innerHTML","display","visibility","img","onload","w_224","parseFloat","width","h_224","height","w_200","h_200","node","parseInt","getContext","drawImage","clearRect","referenceNodeTexture","spriteFrame","getTexture","hintNodeTexture","getComponent","initWithElement","handleLoadedTexture","tempCanvas_200","_pixels","getImageData","data","src","loadLocalResult","texture","w","h","small","sketchNodeTexture","cc","Texture2D","prototype","getPixels","x","y","newWidth","newHeight","idx","color","Class","extends","Component","properties","sketchImg","default","type","Node","referenceImg","resultImg","colorImg","flag","hint","btn","denoise","onV1","onClearClicked","onV2","onV3","onV4","onLoad","director","setClearColor","accept","overflow","insertBefore","firstChild","addEventListener","on","event","getLocation","onSketchClicked","click","onRefenceClicked","onPenClicked","onEraserClicked","cxt","hintNodeTex","onColorizeClicked","hintDataURL","toDataURL","referenceDataURL","sketchDataURL","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","responseText","enabled","string","send","encodeURIComponent","toString","isChecked","onDownloadClicked","onTitle","onHelp","handlePainter","relativeX","relativeY","refPosition","convertToWorldSpace","beginX","beginY","mouseInSketch","pen","beginPath","arc","Math","PI","closePath","fillStyle","r","g","b","fill","handleColorPicker","update","dt","cursor"],"mappings":"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","file":"unknown","sourcesContent":["var spSketchImg;\r\nvar spRefereneImg;\r\nvar spResultImg;\r\nvar spColorImg;\r\nvar spHintNode;\r\nvar spBTN;\r\nvar spLAB;\r\n\r\nvar fileInputForSketch;\r\nvar fileInputForReferene;\r\n\r\nvar mousePosition;\r\nvar mouseInReference = false;\r\n\r\nvar loaded = false;\r\n\r\nvar getMouseDown = false;\r\nvar preMouseInRef = false;\r\nvar selectingColor = false;\r\nvar painting = false;\r\nvar finalX=0;\r\nvar finalY=0;\r\n\r\nvar hasSketch=false;\r\nvar hasRef=false;\r\n\r\nvar HTML_Canvas_sketch;\r\nvar HTML_Canvas_reference;\r\nvar HTML_Canvas_hint;\r\n\r\nvar isPen = true;\r\n\r\nvar mouseIsDown = false;\r\n\r\nvar resultURL = \"\";\r\n\r\nvar version = 2;\r\n\r\nfunction createObjectURL(blob){\r\n    if(window.URL !== undefined)\r\n        return window['URL']['createObjectURL'](blob);\r\n    else\r\n        return window['webkitURL']['createObjectURL'](blob);\r\n}\r\n\r\nfunction onSketchFileSelected(evt) {\r\n    loadLocalSketch(createObjectURL(evt.target.files[0]));\r\n}\r\n\r\nfunction onRefereneFileSelected(evt) {\r\n    loadLocalReference(createObjectURL(evt.target.files[0]));\r\n}\r\n\r\nfunction loadLocalReference(uri){\r\n    var tempDiv = document.getElementById(\"tempDivReference\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivReference\";\r\n        tempDiv.innerHTML = '<img id=imgheadReference>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadReference');\r\n    img.onload = function(){\r\n        \r\n        var w_224 = parseFloat(this.width);\r\n\t\tvar h_224 = parseFloat(this.height);\r\n\t\tif(w_224 > h_224)\r\n\t\t{\r\n\t\t    w_224 = 224.0 / h_224 * w_224;\r\n\t\t    h_224 = 224.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h_224 = 224.0 / w_224 * h_224;\r\n\t\t    w_224 = 224.0;\r\n\t\t}\r\n\t\t\r\n\t\tvar w_200 = parseFloat(this.width);\r\n\t\tvar h_200 = parseFloat(this.height);\r\n\t\tif(w_200 < h_200)\r\n\t\t{\r\n\t\t    w_200 = 200.0 / h_200 * w_200;\r\n\t\t    h_200 = 200.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h_200 = 200.0 / w_200 * h_200;\r\n\t\t    w_200 = 200.0;\r\n\t\t}\r\n\t\t\r\n\t\tspRefereneImg.node.width = parseInt(w_200);\r\n\t\tspRefereneImg.node.height = parseInt(h_200);\r\n\t\tHTML_Canvas_reference.width = parseInt(w_224);\r\n        HTML_Canvas_reference.height = parseInt(h_224);\r\n        \r\n        HTML_Canvas_reference.getContext(\"2d\").drawImage(this, 0, 0, HTML_Canvas_reference.width, HTML_Canvas_reference.height);\r\n        HTML_Canvas_hint.getContext(\"2d\").clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n        \r\n        var referenceNodeTexture = spRefereneImg.spriteFrame.getTexture();\r\n\t\tvar hintNodeTexture = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n        \r\n\t\thintNodeTexture.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\treferenceNodeTexture.initWithElement(HTML_Canvas_reference);\r\n\t\treferenceNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\tvar tempCanvas_200 = document.createElement(\"canvas\");\r\n        tempCanvas_200.width = parseInt(w_200);\r\n        tempCanvas_200.height = parseInt(h_200);\r\n        tempCanvas_200.getContext(\"2d\").drawImage(this, 0, 0, tempCanvas_200.width, tempCanvas_200.height);\r\n        referenceNodeTexture._pixels = tempCanvas_200.getContext(\"2d\").getImageData(0, 0, tempCanvas_200.width, tempCanvas_200.height).data;\r\n\t\t\r\n\t\thasRef = true;\r\n    }\r\n\timg.src = uri;\r\n}\r\n\r\nfunction loadLocalResult(uri){\r\n    var tempDiv = document.getElementById(\"tempDivResult\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivResult\";\r\n        tempDiv.innerHTML = '<img id=imgheadResult>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadResult');\r\n    img.onload = function(){\r\n        \r\n\t\tvar texture = spResultImg.spriteFrame.getTexture();\r\n\t\ttexture.initWithElement(this);\r\n\t\ttexture.handleLoadedTexture();\r\n\t\tvar w = parseFloat(this.width);\r\n\t\tvar h = parseFloat(this.height);\r\n\t\t\r\n\t\tvar small = true;\r\n\t\t\r\n\t\tif(w>h){\r\n\t\t    if(w>724){\r\n\t\t        small = false;\r\n\t\t    }\r\n\t\t}else{\r\n\t\t    if(h>724){\r\n\t\t        small = false;\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tif(!small){\r\n\t\t    if(w<h)\r\n\t\t    {\r\n\t\t        w = 724.0 / h * w;\r\n\t\t        h = 724.0;\r\n\t\t    }\r\n\t\t    else\r\n\t\t    {\r\n\t\t        h = 724.0 / w * h;\r\n\t\t        w = 724.0;\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tspResultImg.node.width = parseInt(w);\r\n\t\tspResultImg.node.height = parseInt(h);\r\n    }\r\n\timg.src = uri;\r\n\tresultURL = uri;\r\n}\r\n\r\nfunction loadLocalSketch(uri){\r\n    var tempDiv = document.getElementById(\"tempDivSketch\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivSketch\";\r\n        tempDiv.innerHTML = '<img id=imgheadSketch>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadSketch');\r\n    img.onload = function(){\r\n        \r\n        var w = parseFloat(this.width);\r\n\t\tvar h = parseFloat(this.height);\r\n\t\tHTML_Canvas_sketch.width = parseInt(w);\r\n        HTML_Canvas_sketch.height = parseInt(h);\r\n        \r\n\t\tif(w > h)\r\n\t\t{\r\n\t\t    w = 512.0 / h * w;\r\n\t\t    h = 512.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h = 512.0 / w * h;\r\n\t\t    w = 512.0;\r\n\t\t}\r\n        \r\n        HTML_Canvas_hint.width = parseInt(w);\r\n\t\tHTML_Canvas_hint.height = parseInt(h);\r\n        \r\n\t\tw = parseFloat(this.width);\r\n\t\th = parseFloat(this.height);\r\n\t\tif(w < h)\r\n\t\t{\r\n\t\t    w = 512.0 / h * w;\r\n\t\t    h = 512.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h = 512.0 / w * h;\r\n\t\t    w = 512.0;\r\n\t\t}\r\n\t\t\r\n\t\tspSketchImg.node.width = parseInt(w);\r\n\t\tspSketchImg.node.height = parseInt(h);\r\n\t\tspHintNode.width = parseInt(w);\r\n\t\tspHintNode.height = parseInt(h);\r\n\r\n        HTML_Canvas_sketch.getContext(\"2d\").drawImage(this, 0, 0, HTML_Canvas_sketch.width, HTML_Canvas_sketch.height);\r\n\t    HTML_Canvas_hint.getContext(\"2d\").clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n\t    \r\n        var hintNodeTexture = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n\t\thintNodeTexture.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\tvar sketchNodeTexture = spSketchImg.spriteFrame.getTexture();\r\n\t\tsketchNodeTexture.initWithElement(HTML_Canvas_sketch);\r\n\t\tsketchNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\thasSketch = true;\r\n    }\r\n\timg.src = uri;\r\n}\r\n\r\ncc.Texture2D.prototype._pixels = [];\r\ncc.Texture2D.prototype.getPixels = function(x,y,newWidth,newHeight){\r\n    var idx = parseInt((newHeight-parseInt(y)) * newWidth * 4 + parseInt(x) * 4);\r\n    return new cc.color(this._pixels[idx],this._pixels[idx + 1],this._pixels[idx + 2]);\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        sketchImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        referenceImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        resultImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        colorImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        flag:{\r\n            default:null,type:cc.Node\r\n        },\r\n        hint:{\r\n            default:null,type:cc.Node\r\n        },\r\n        btn:{\r\n            default:null,type:cc.Node\r\n        },\r\n        denoise:{\r\n            default:null,type:cc.Node\r\n        },\r\n    },\r\n    \r\n    onV1: function(){\r\n        version = 1;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV2: function(){\r\n        version = 2;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV3: function(){\r\n        version = 3;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV4: function(){\r\n        version = 4;\r\n        this.onClearClicked();\r\n    },\r\n\r\n    onLoad: function () {\r\n        \r\n        cc.director.setClearColor(cc.color(0, 0, 0, 0))\r\n        \r\n        spSketchImg = this.sketchImg.getComponent('cc.Sprite');\r\n        spRefereneImg = this.referenceImg.getComponent('cc.Sprite');\r\n        spResultImg = this.resultImg.getComponent('cc.Sprite');\r\n        spColorImg = this.colorImg.getComponent('cc.Sprite');\r\n        spHintNode = this.hint;\r\n        spBTN = this.btn.getComponent('cc.Button');\r\n        spLAB = this.btn.getComponent('cc.RichText');\r\n        \r\n        fileInputForSketch = document.createElement(\"input\");\r\n        fileInputForSketch.id = \"fileInputForSketch\";\r\n        fileInputForSketch.type = \"file\";\r\n        fileInputForSketch.accept = \"image/*\";\r\n        fileInputForSketch.style.height = \"0px\";\r\n        fileInputForSketch.style.display = \"block\";\r\n        fileInputForSketch.style.overflow = \"hidden\";\r\n        document.body.insertBefore(fileInputForSketch,document.body.firstChild);\r\n        fileInputForSketch.addEventListener('change', onSketchFileSelected, false);\r\n        \r\n        fileInputForReferene = document.createElement(\"input\");\r\n        fileInputForReferene.id = \"fileInputForReferene\";\r\n        fileInputForReferene.type = \"file\";\r\n        fileInputForReferene.accept = \"image/*\";\r\n        fileInputForReferene.style.height = \"0px\";\r\n        fileInputForReferene.style.display = \"block\";\r\n        fileInputForReferene.style.overflow = \"hidden\";\r\n        document.body.insertBefore(fileInputForReferene,document.body.firstChild);\r\n        fileInputForReferene.addEventListener('change', onRefereneFileSelected, false);\r\n        \r\n        this.node.on(\"mousemove\", function (event) { \r\n            mousePosition = event.getLocation();\r\n        });\r\n        \r\n        this.node.on(\"mousedown\", function (event) { \r\n            mouseIsDown = true;\r\n        });\r\n        \r\n        this.node.on(\"mouseup\", function (event) { \r\n            getMouseDown = true;\r\n            mouseIsDown = false;\r\n        });\r\n        \r\n        HTML_Canvas_hint = document.createElement(\"canvas\");\r\n        HTML_Canvas_hint.id = \"HTML_Canvas_hint\";\r\n        \r\n        HTML_Canvas_reference = document.createElement(\"canvas\");\r\n        HTML_Canvas_reference.id = \"HTML_Canvas_reference\";\r\n        \r\n        HTML_Canvas_sketch = document.createElement(\"canvas\");\r\n        HTML_Canvas_sketch.id = \"HTML_Canvas_sketch\";\r\n        \r\n        loaded = true;\r\n        \r\n    },\r\n    \r\n    onSketchClicked: function(){\r\n        fileInputForSketch.click();\r\n    },\r\n    onRefenceClicked: function(){\r\n        fileInputForReferene.click();\r\n    },\r\n    onPenClicked: function(){\r\n        isPen = true;\r\n    },\r\n    onEraserClicked: function(){\r\n        isPen = false;\r\n    },\r\n    onClearClicked: function(){\r\n        var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n\t    cxt.clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n        var hintNodeTex = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n\t\thintNodeTex.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTex.handleLoadedTexture();\r\n    },\r\n    onColorizeClicked: function(){\r\n        if(!hasRef){\r\n            return;\r\n        }\r\n        if(!hasSketch){\r\n            return;\r\n        }\r\n        \r\n        var hintDataURL = HTML_Canvas_hint.toDataURL(\"image/png\");\r\n        var referenceDataURL = HTML_Canvas_reference.toDataURL(\"image/png\");\r\n        var sketchDataURL = HTML_Canvas_sketch.toDataURL(\"image/png\");\r\n        \r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"POST\", \"/paint\", true);\r\n        xhr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded;\");\r\n        xhr.onreadystatechange = function() {\r\n            loadLocalResult(xhr.responseText);\r\n            spBTN.enabled = true;\r\n            spLAB.string = \"<u>colorize</u>\";\r\n        };\r\n        xhr.send\r\n            (\r\n            \"sketch=\"+encodeURIComponent(sketchDataURL)+\r\n            \"&reference=\"+encodeURIComponent(referenceDataURL)+\r\n            \"&hint=\"+encodeURIComponent(hintDataURL)+\r\n            \"&version=\"+version.toString()+\r\n            \"&denoise=\"+this.denoise.getComponent('cc.Toggle').isChecked.toString()\r\n            );\r\n        spBTN.enabled = false;\r\n        spLAB.string = \"Waiting\";\r\n    },\r\n    onDownloadClicked: function(){\r\n        if(resultURL==\"\"){\r\n            return;\r\n        }\r\n        window.open(resultURL);\r\n    },\r\n    onTitle: function(){\r\n        window.open('https://github.com/lllyasviel/style2paints','gitHub');\r\n    },\r\n    onHelp: function(){\r\n        window.open('https://github.com/lllyasviel/style2paints/issues/12','gitHub');\r\n    },\r\n    handlePainter: function(){\r\n        painting = false;\r\n        var relativeX = 0;\r\n        var relativeY = 0;\r\n        var refPosition = spSketchImg.node.convertToWorldSpace(spSketchImg.node.position);\r\n        if(refPosition != null && mousePosition != null){\r\n            var beginX = refPosition.x - 256;\r\n            var beginY = refPosition.y - 256;\r\n            relativeX = mousePosition.x - beginX;\r\n            relativeY = mousePosition.y - beginY;\r\n            var mouseInSketch = (relativeX > 0 && relativeY > 0 && relativeX < spSketchImg.node.width && relativeY < spSketchImg.node.height);\r\n            if(mouseInSketch){\r\n                painting = true;\r\n            }\r\n        }\r\n        if(painting){\r\n            if(mouseIsDown){\r\n                var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n                \r\n                if(isPen){\r\n                    var pen = 6 - version;\r\n                    cxt.beginPath();\r\n                    cxt.arc(parseInt(parseFloat(relativeX) / parseFloat(spHintNode.width) * parseFloat(HTML_Canvas_hint.width)), parseInt(parseFloat(spHintNode.height - relativeY) / parseFloat(spHintNode.height) * parseFloat(HTML_Canvas_hint.height)), pen, 0, Math.PI * 2, true);\r\n                    cxt.closePath();\r\n                    var color = spColorImg.node.color\r\n                    cxt.fillStyle = 'rgba('+color.r.toString()+','+color.g.toString()+','+color.b.toString()+',0.618)';\r\n                    cxt.fill();\r\n                }else{\r\n                    var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n                    cxt.clearRect(parseInt(parseFloat(relativeX) / parseFloat(spHintNode.width) * parseFloat(HTML_Canvas_hint.width)) - 10, parseInt(parseFloat(spHintNode.height - relativeY) / parseFloat(spHintNode.height) * parseFloat(HTML_Canvas_hint.height)) - 10,20,20);\r\n                }\r\n                \r\n                var hintNodeTex = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n                hintNodeTex.initWithElement(HTML_Canvas_hint);\r\n                hintNodeTex.handleLoadedTexture(true);\r\n            }\r\n        }\r\n    },\r\n    handleColorPicker: function(){\r\n        var refPosition = spRefereneImg.node.convertToWorldSpace(spRefereneImg.node.position);\r\n            if(refPosition != null && mousePosition != null){\r\n                var beginX = refPosition.x;\r\n                var beginY = refPosition.y;\r\n                var relativeX = mousePosition.x - beginX;\r\n                var relativeY = mousePosition.y - beginY;\r\n                mouseInReference = (relativeX > 0 && relativeY > 0 && relativeX < spRefereneImg.node.width && relativeY < spRefereneImg.node.height);\r\n                if(mouseInReference){\r\n                    if(!preMouseInRef){\r\n                        selectingColor = true;\r\n                    }\r\n                    if(getMouseDown){\r\n                        if(selectingColor){\r\n                        this.flag.x = relativeX - spRefereneImg.node.width / 2;\r\n                        this.flag.y = relativeY - spRefereneImg.node.height / 2;\r\n                        finalX = relativeX;\r\n                        finalY = relativeY;\r\n                        isPen = true;\r\n                        }\r\n                    }\r\n                }else{\r\n                    if(selectingColor){\r\n                        selectingColor = false;\r\n                        var texture = spRefereneImg.spriteFrame.getTexture();\r\n                        spColorImg.node.color = spRefereneImg.spriteFrame.getTexture().getPixels(finalX,finalY,spRefereneImg.node.width,spRefereneImg.node.height);\r\n                    }\r\n                }\r\n                if(selectingColor){\r\n                    var texture = spRefereneImg.spriteFrame.getTexture();\r\n                    spColorImg.node.color = spRefereneImg.spriteFrame.getTexture().getPixels(relativeX,relativeY,spRefereneImg.node.width,spRefereneImg.node.height);\r\n                }\r\n            }\r\n    },\r\n    update: function (dt) {\r\n        if(loaded){\r\n            this.handleColorPicker();\r\n            this.handlePainter();\r\n            if(selectingColor)\r\n            {\r\n                document.body.style.cursor='crosshair';\r\n            }\r\n            else if(painting)\r\n            {\r\n                document.body.style.cursor='crosshair';\r\n            }\r\n            else\r\n            {\r\n                document.body.style.cursor='default';\r\n            }\r\n        }\r\n        preMouseInRef = mouseInReference;\r\n        getMouseDown = false;\r\n    },\r\n});\r\n"]}